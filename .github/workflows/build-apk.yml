name: Build APK from PWA

on:
  workflow_dispatch:
    inputs:
      appName:
        description: 'Ù†Ø§Ù… Ø§Ù¾Ù„ÛŒÚ©ÛŒØ´Ù†'
        required: true
        default: 'Ø§Ù¾Ù„ÛŒÚ©ÛŒØ´Ù† Ù…Ù†'
      packageId:
        description: 'Ø´Ù†Ø§Ø³Ù‡ Ù¾Ú©ÛŒØ¬ Ø§Ù†Ø¯Ø±ÙˆÛŒØ¯'
        required: true
        default: 'com.example.pwa'
      siteUrl:
        description: 'Ø¢Ø¯Ø±Ø³ Ø³Ø§ÛŒØª'
        required: true
        default: 'https://example.com'
      themeColor:
        description: 'Ø±Ù†Ú¯ ØªÙ…'
        required: true
        default: '#7c3aed'
      backgroundColor:
        description: 'Ø±Ù†Ú¯ Ù¾Ø³â€ŒØ²Ù…ÛŒÙ†Ù‡'
        required: true
        default: '#ffffff'
      displayMode:
        description: 'Ø­Ø§Ù„Øª Ù†Ù…Ø§ÛŒØ´'
        required: true
        default: 'standalone'
      versionCode:
        description: 'Ú©Ø¯ Ù†Ø³Ø®Ù‡'
        required: true
        default: '1'
      versionName:
        description: 'Ù†Ø§Ù… Ù†Ø³Ø®Ù‡'
        required: true
        default: '1.0.0'

jobs:
  build-apk:
    runs-on: ubuntu-latest
    steps:
      - name: ğŸ› ï¸ Ø¢Ù…Ø§Ø¯Ù‡â€ŒØ³Ø§Ø²ÛŒ Ù…Ø­ÛŒØ·
        run: |
          sudo apt-get update
          sudo apt-get install -y curl imagemagick
          curl -fsSL https://deb.nodesource.com/setup_18.x | sudo -E bash -
          sudo apt-get install -y nodejs
          npm install -g @bubblewrap/cli

      - name: ğŸ“¥ Ø¯Ø±ÛŒØ§ÙØª ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ PWA
        uses: actions/checkout@v3

      - name: ğŸ—ï¸ Ø³Ø§Ø®Øª APK
        run: |
          bubblewrap init --manifest=./manifest.json
          bubblewrap build

      - name: ğŸ“¤ Ø¢Ù¾Ù„ÙˆØ¯ APK
        uses: actions/upload-artifact@v3
        with:
          name: app-apk
          path: app-release-signed.apk
          retention-days: 30
