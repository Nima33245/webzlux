name: Build APK from PWA

on:
  workflow_dispatch:
    inputs:
      appName:
        description: 'نام اپلیکیشن'
        required: true
        default: 'اپلیکیشن من'
      packageId:
        description: 'شناسه پکیج اندروید'
        required: true
        default: 'com.example.pwa'
      siteUrl:
        description: 'آدرس سایت'
        required: true
        default: 'https://example.com'
      themeColor:
        description: 'رنگ تم'
        required: true
        default: '#7c3aed'
      backgroundColor:
        description: 'رنگ پس‌زمینه'
        required: true
        default: '#ffffff'
      displayMode:
        description: 'حالت نمایش'
        required: true
        default: 'standalone'
      versionCode:
        description: 'کد نسخه'
        required: true
        default: '1'
      versionName:
        description: 'نام نسخه'
        required: true
        default: '1.0.0'

jobs:
  build-apk:
    runs-on: ubuntu-latest
    steps:
      - name: 🛠️ آماده‌سازی محیط
        run: |
          sudo apt-get update
          sudo apt-get install -y curl imagemagick
          curl -fsSL https://deb.nodesource.com/setup_18.x | sudo -E bash -
          sudo apt-get install -y nodejs
          npm install -g @bubblewrap/cli

      - name: 📥 دریافت فایل‌های PWA
        uses: actions/checkout@v3

      - name: 🏗️ ساخت APK
        run: |
          bubblewrap init --manifest=./manifest.json
          bubblewrap build

      - name: 📤 آپلود APK
        uses: actions/upload-artifact@v3
        with:
          name: app-apk
          path: app-release-signed.apk
          retention-days: 30
