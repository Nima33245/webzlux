<!doctype html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="utf-8">
  <title>اپ‌ساز حرفه‌ای (PWA + APK)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    :root{--brand:#1f6feb}
    .glass{backdrop-filter:saturate(1.2) blur(8px); background: linear-gradient(180deg, rgba(255,255,255,.65), rgba(255,255,255,.45))}
    .dark .glass{background: linear-gradient(180deg, rgba(25,25,28,.65), rgba(25,25,28,.45))}
    .mono{font-feature-settings:"ss01","cv01";}
    .card{border:1px solid rgba(0,0,0,.08); border-radius:16px}
    .dark .card{border-color:rgba(255,255,255,.12)}
    .tag{background:rgba(31,111,235,.09); color:#1f6feb; border:1px solid rgba(31,111,235,.2); padding:.25rem .5rem; border-radius:.5rem; font-size:.75rem}
    .btn{background:#1f6feb;color:#fff;border-radius:.75rem;padding:.65rem 1rem}
    .btn-ghost{background:transparent;color:#1f6feb;border:1px solid rgba(31,111,235,.5);border-radius:.75rem;padding:.65rem 1rem}
    .btn-secondary{background:#6a737d;color:#fff;border-radius:.75rem;padding:.65rem 1rem}
    .grid-2{display:grid;grid-template-columns:1fr 1fr;gap:1rem}
    .grid-3{display:grid;grid-template-columns:1fr 1fr 1fr;gap:1rem}
    .input{border:1px solid rgba(0,0,0,.15);border-radius:.75rem;padding:.65rem}
    .dark .input{border-color:rgba(255,255,255,.2);background:rgba(255,255,255,.05)}
    .badge-ok{color:#0b8b36}
    .badge-warn{color:#a15a00}
    .preview-card{border-radius:20px; border:1px solid rgba(0,0,0,.08); padding:1rem; display:flex; gap:1rem; align-items:center}
    .dark .preview-card{border-color:rgba(255,255,255,.12)}
    .sw-code{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,monospace;font-size:12px}
  </style>
  <!-- Libraries -->
  <script src="https://cdn.jsdelivr.net/npm/jszip@3.10.1/dist/jszip.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/file-saver@2.0.5/dist/FileSaver.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js"></script>
</head>
<body class="bg-slate-50 dark:bg-slate-900 transition-colors">
  <div class="max-w-6xl mx-auto p-6">
    <!-- Header -->
    <div class="glass card p-6 mb-6 flex items-center justify-between">
      <div>
        <h1 class="text-2xl font-bold text-slate-900 dark:text-slate-100">🚀 اپ‌ساز حرفه‌ای (PWA فوری + APK با GitHub Actions)</h1>
        <p class="text-slate-600 dark:text-slate-300">فرم را پر کن، وب‌اپلیکیشن ZIP همین‌جا دانلود می‌شود. برای APK، ورک‌فلو را با همین ورودی‌ها اجرا کن.</p>
      </div>
      <div class="flex items-center gap-2">
        <span class="tag">بدون سرور</span>
        <button id="toggleTheme" class="btn-ghost">حالت تاریک/روشن</button>
      </div>
    </div>

    <!-- Main grid -->
    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
      <!-- Left column: Form -->
      <div class="lg:col-span-2 glass card p-6">
        <h2 class="text-xl font-semibold text-slate-900 dark:text-slate-100 mb-4">اطلاعات اپلیکیشن</h2>
        <div class="grid-2">
          <div>
            <label class="text-slate-700 dark:text-slate-300">نام اپ</label>
            <input id="appName" class="input w-full" placeholder="مثلاً: تعمیر تخصصی مبلمان" value="سایت من">
          </div>
          <div>
            <label class="text-slate-700 dark:text-slate-300">شناسه پکیج اندروید</label>
            <input id="packageId" class="input w-full" placeholder="مثلاً: com.nima.furniture" value="com.example.myapp">
          </div>
        </div>
        <div class="grid-2 mt-3">
          <div>
            <label class="text-slate-700 dark:text-slate-300">آدرس سایت (start_url)</label>
            <input id="siteUrl" class="input w-full" placeholder="https://example.com" value="https://example.com">
          </div>
          <div>
            <label class="text-slate-700 dark:text-slate-300">اسکوپ</label>
            <input id="scope" class="input w-full" placeholder="/" value="/">
          </div>
        </div>
        <div class="grid-3 mt-3">
          <div>
            <label class="text-slate-700 dark:text-slate-300">رنگ تم</label>
            <input id="themeColor" type="color" class="input w-full" value="#1f6feb">
          </div>
          <div>
            <label class="text-slate-700 dark:text-slate-300">رنگ پس‌زمینه</label>
            <input id="bgColor" type="color" class="input w-full" value="#ffffff">
          </div>
          <div>
            <label class="text-slate-700 dark:text-slate-300">Display</label>
            <select id="display" class="input w-full">
              <option value="standalone">standalone</option>
              <option value="fullscreen">fullscreen</option>
              <option value="minimal-ui">minimal-ui</option>
            </select>
          </div>
        </div>
        <div class="mt-4">
          <label class="text-slate-700 dark:text-slate-300">توضیحات</label>
          <input id="description" class="input w-full" placeholder="توضیح کوتاه اپ">
        </div>

        <!-- Icons & Splash -->
        <div class="mt-6">
          <h3 class="text-lg font-semibold text-slate-900 dark:text-slate-100">آیکن‌ها و اسپلش</h3>
          <div class="grid-3 mt-2">
            <div>
              <label class="text-slate-700 dark:text-slate-300">آیکن 512×512 (PNG)</label>
              <input id="icon512" type="file" accept="image/png" class="input w-full">
            </div>
            <div>
              <label class="text-slate-700 dark:text-slate-300">آیکن 192×192 (PNG)</label>
              <input id="icon192" type="file" accept="image/png" class="input w-full">
            </div>
            <div>
              <label class="text-slate-700 dark:text-slate-300">اسپلش 1024×500 (PNG)</label>
              <input id="splash" type="file" accept="image/png" class="input w-full">
            </div>
          </div>
          <div class="mt-3 grid-3">
            <button id="genMaskable" class="btn-ghost">ساخت آیکن Maskable</button>
            <button id="auto192" class="btn-ghost">تولید خودکار 192 از 512</button>
            <button id="autoSplash" class="btn-ghost">تولید اسپلش از آیکن</button>
          </div>
        </div>

        <!-- Advanced -->
        <div class="mt-6">
          <h3 class="text-lg font-semibold text-slate-900 dark:text-slate-100">گزینه‌های حرفه‌ای</h3>
          <div class="grid-2 mt-2">
            <div>
              <label class="text-slate-700 dark:text-slate-300">Categories (کاما جدا)</label>
              <input id="categories" class="input w-full" placeholder="business,tools">
            </div>
            <div>
              <label class="text-slate-700 dark:text-slate-300">Screenshots URL (کاما جدا)</label>
              <input id="screenshots" class="input w-full" placeholder="https://.../shot1.png, https://.../shot2.png">
            </div>
          </div>
          <div class="mt-2">
            <label class="text-slate-700 dark:text-slate-300">Shortcuts</label>
            <div class="grid-3">
              <input id="shortcutName" class="input" placeholder="نام شورتکات">
              <input id="shortcutUrl" class="input" placeholder="https://example.com/page">
              <button id="addShortcut" class="btn-ghost">افزودن</button>
            </div>
            <ul id="shortcutList" class="mt-2 text-slate-700 dark:text-slate-300"></ul>
          </div>
        </div>

        <!-- Actions -->
        <div class="mt-6 flex gap-3">
          <button id="buildPWA" class="btn">ساخت وب‌اپلیکیشن و دانلود ZIP</button>
          <button id="prepAPK" class="btn-secondary">راهنمای بیلد APK</button>
          <button id="resetForm" class="btn-ghost">پاک‌سازی فرم</button>
        </div>
      </div>

      <!-- Right column: Preview & QR & Checks -->
      <div class="glass card p-6">
        <h2 class="text-xl font-semibold text-slate-900 dark:text-slate-100 mb-4">پیش‌نمایش و بررسی‌ها</h2>
        <div class="preview-card bg-white dark:bg-slate-800">
          <canvas id="previewIcon" width="96" height="96" class="rounded-2xl border"></canvas>
          <div>
            <div id="previewName" class="text-lg font-bold text-slate-900 dark:text-slate-100">سایت من</div>
            <div id="previewDesc" class="text-slate-600 dark:text-slate-300 text-sm">توضیح اپ نمایش داده می‌شود</div>
            <div class="mt-2 flex gap-2 items-center">
              <span class="text-sm">Theme:</span>
              <div id="previewTheme" class="w-6 h-6 rounded border"></div>
              <span class="text-sm">BG:</span>
              <div id="previewBg" class="w-6 h-6 rounded border"></div>
            </div>
          </div>
        </div>

        <div class="mt-4">
          <h3 class="text-lg font-semibold text-slate-900 dark:text-slate-100">چک‌لیست PWA</h3>
          <ul id="checks" class="text-sm space-y-2 text-slate-700 dark:text-slate-300">
            <li>HTTPS سایت: <span id="checkHttps" class="badge-warn">نامشخص</span></li>
            <li>start_url معتبر: <span id="checkStart" class="badge-warn">نامشخص</span></li>
            <li>آیکن‌ها آماده: <span id="checkIcons" class="badge-warn">نامشخص</span></li>
            <li>رنگ‌ها تنظیم: <span id="checkColors" class="badge-warn">نامشخص</span></li>
            <li>Service Worker حاضر: <span id="checkSw" class="badge-warn">بله (تولید می‌شود)</span></li>
          </ul>
        </div>

        <div class="mt-6">
          <h3 class="text-lg font-semibold text-slate-900 dark:text-slate-100">QR لینک PWA یا APK</h3>
          <div class="grid-2">
            <input id="qrUrl" class="input w-full" placeholder="https://yourdomain.com/pwa/index.html">
            <button id="makeQR" class="btn">ساخت QR</button>
          </div>
          <div class="mt-3 flex items-center gap-3">
            <canvas id="qrCanvas" width="160" height="160" class="rounded-lg bg-white"></canvas>
            <div id="qrText" class="text-sm text-slate-600 dark:text-slate-300"></div>
          </div>
        </div>

        <div class="mt-6">
          <h3 class="text-lg font-semibold text-slate-900 dark:text-slate-100">لاگ و خروجی</h3>
          <div id="log" class="text-xs sw-code bg-slate-800 text-slate-100 p-3 rounded-lg h-40 overflow-auto"></div>
        </div>
      </div>
    </div>

    <div class="text-center text-slate-500 dark:text-slate-400 mt-6 text-sm">
      ساخته‌شده برای کار حرفه‌ای، بدون وابستگی به سرور. ZIP را روی هاست HTTPS قرار بده؛ APK را از Actions بساز.
    </div>
  </div>

<script>
/* State & utils */
const S = { shortcuts: [] };
const $ = id => document.getElementById(id);
const log = msg => { const l = $('log'); l.textContent += (msg + '\n'); l.scrollTop = l.scrollHeight; };
const isHttps = url => { try { const u = new URL(url); return u.protocol === 'https:'; } catch{ return false; } };
const fitToCanvas = async (file, size) => {
  if (!file) return genDefaultIcon(size);
  const buf = await file.arrayBuffer();
  const bmp = await createImageBitmap(new Blob([buf]));
  const c = document.createElement('canvas'); c.width=size; c.height=size;
  const ctx = c.getContext('2d'); ctx.clearRect(0,0,size,size);
  const scale = Math.min(size/bmp.width, size/bmp.height);
  const w = Math.round(bmp.width*scale), h = Math.round(bmp.height*scale);
  ctx.drawImage(bmp,(size-w)/2,(size-h)/2,w,h);
  return await new Promise(res => c.toBlob(res, 'image/png'));
};
const genDefaultIcon = async size => {
  const c = document.createElement('canvas'); c.width=size; c.height=size;
  const ctx = c.getContext('2d');
  ctx.fillStyle = $('themeColor').value; ctx.fillRect(0,0,size,size);
  ctx.fillStyle = '#fff'; ctx.textAlign='center'; ctx.textBaseline='middle';
  ctx.font = `${Math.round(size*0.5)}px system-ui`; ctx.fillText('A', size/2, size/2);
  return await new Promise(res => c.toBlob(res, 'image/png'));
};
const blobToCanvas = async blob => {
  const bmp = await createImageBitmap(blob);
  const c = document.createElement('canvas'); c.width=bmp.width; c.height=bmp.height;
  const ctx = c.getContext('2d'); ctx.drawImage(bmp,0,0);
  return c;
};

/* Theme toggle */
$('toggleTheme').addEventListener('click', () => {
  document.documentElement.classList.toggle('dark');
  localStorage.setItem('theme', document.documentElement.classList.contains('dark') ? 'dark' : 'light');
});
if (localStorage.getItem('theme') === 'dark') document.documentElement.classList.add('dark');

/* Live preview */
function refreshPreview(){
  $('previewName').textContent = $('appName').value || 'App';
  $('previewDesc').textContent = $('description').value || 'توضیح اپ';
  $('previewTheme').style.background = $('themeColor').value;
  $('previewBg').style.background = $('bgColor').value;
}
['appName','description','themeColor','bgColor'].forEach(id => $(id).addEventListener('input', refreshPreview));
refreshPreview();

/* Checks */
function runChecks(){
  const httpsOk = isHttps($('siteUrl').value);
  $('checkHttps').textContent = httpsOk ? 'بله (HTTPS)' : 'خیر';
  $('checkHttps').className = httpsOk ? 'badge-ok' : 'badge-warn';

  const startOk = /^https?:\/\/.+/.test($('siteUrl').value);
  $('checkStart').textContent = startOk ? 'بله' : 'خیر';
  $('checkStart').className = startOk ? 'badge-ok' : 'badge-warn';

  const iconsOk = ($('icon192').files.length || $('icon512').files.length);
  $('checkIcons').textContent = iconsOk ? 'بله' : 'خیر (از آیکن پیش‌فرض استفاده می‌شود)';
  $('checkIcons').className = iconsOk ? 'badge-ok' : 'badge-warn';

  const colorsOk = $('themeColor').value && $('bgColor').value;
  $('checkColors').textContent = colorsOk ? 'بله' : 'خیر';
  $('checkColors').className = colorsOk ? 'badge-ok' : 'badge-warn';

  $('checkSw').textContent = 'بله (تولید می‌شود)';
  $('checkSw').className = 'badge-ok';
}
['siteUrl','icon192','icon512','themeColor','bgColor'].forEach(id => $(id).addEventListener('input', runChecks));
runChecks();

/* Shortcuts add/remove */
$('addShortcut').addEventListener('click', () => {
  const name = $('shortcutName').value.trim();
  const url = $('shortcutUrl').value.trim();
  if (!name || !url) return;
  S.shortcuts.push({ name, url, short_name: name, url: url, icons: [] });
  const li = document.createElement('li');
  li.textContent = `${name} → ${url}`;
  const btn = document.createElement('button'); btn.textContent='حذف'; btn.className='btn-ghost ml-2';
  btn.onclick = () => { S.shortcuts = S.shortcuts.filter(s => s.url!==url); li.remove(); };
  li.appendChild(btn);
  $('shortcutList').appendChild(li);
  $('shortcutName').value=''; $('shortcutUrl').value='';
});

/* Icon helpers */
$('genMaskable').addEventListener('click', async () => {
  log('ساخت آیکن maskable از 512...');
  const src = $('icon512').files[0] || null;
  const base = await fitToCanvas(src, 512);
  const canvas = await blobToCanvas(base);
  const ctx = canvas.getContext('2d');
  // ماسک: حلقه ایمن برای بریدن در دستگاه‌ها
  ctx.strokeStyle = 'rgba(255,255,255,0.25)'; ctx.lineWidth = 32;
  ctx.beginPath(); ctx.arc(256,256,224,0,Math.PI*2); ctx.stroke();
  canvas.toBlob(b => {
    const dl = document.createElement('a');
    dl.href = URL.createObjectURL(b); dl.download = 'icon-512-maskable.png'; dl.click();
    log('✅ آیکن maskable آماده و دانلود شد.');
  }, 'image/png');
});
$('auto192').addEventListener('click', async () => {
  log('تولید 192 از 512...');
  const src = $('icon512').files[0] || null;
  const blob = await fitToCanvas(src, 192);
  const dl = document.createElement('a');
  dl.href = URL.createObjectURL(blob); dl.download = 'icon-192.png'; dl.click();
  log('✅ آیکن 192 آماده و دانلود شد.');
});
$('autoSplash').addEventListener('click', async () => {
  log('تولید اسپلش از آیکن...');
  const src = $('icon512').files[0] || null;
  const icon = await fitToCanvas(src, 256);
  const icCanvas = await blobToCanvas(icon);
  const c = document.createElement('canvas'); c.width=1024; c.height=500;
  const ctx = c.getContext('2d');
  const bg = $('bgColor').value; ctx.fillStyle = bg; ctx.fillRect(0,0,1024,500);
  ctx.drawImage(icCanvas, (1024-256)/2, (500-256)/2, 256, 256);
  c.toBlob(b => {
    const dl = document.createElement('a');
    dl.href = URL.createObjectURL(b); dl.download='splash.png'; dl.click();
    log('✅ اسپلش آماده و دانلود شد.');
  }, 'image/png');
});

/* Preview icon draw */
(async function updatePreviewIcon(){
  const icon = await fitToCanvas($('icon512').files[0], 96);
  const canvas = $('previewIcon');
  const bmp = await createImageBitmap(icon);
  const ctx = canvas.getContext('2d'); ctx.clearRect(0,0,96,96); ctx.drawImage(bmp,0,0,96,96);
})();
['icon512'].forEach(id => $(id).addEventListener('change', async ()=>{updatePreviewIcon();}));

/* Build ZIP */
$('buildPWA').addEventListener('click', async () => {
  log('شروع ساخت ZIP...');
  const appName = $('appName').value.trim() || 'App';
  const siteUrl = $('siteUrl').value.trim();
  const scope = $('scope').value.trim() || '/';
  const themeColor = $('themeColor').value || '#1f6feb';
  const bgColor = $('bgColor').value || '#ffffff';
  const display = $('display').value || 'standalone';
  const description = $('description').value || '';
  if (!/^https?:\/\/.+/.test(siteUrl)) { log('❌ آدرس start_url معتبر نیست.'); return; }

  const icon512 = await fitToCanvas($('icon512').files[0], 512);
  const icon192 = await fitToCanvas($('icon192').files[0], 192);
  const splash = $('splash').files[0] || null;

  const manifest = {
    name: appName,
    short_name: appName,
    start_url: siteUrl,
    scope, display,
    background_color: bgColor,
    theme_color: themeColor,
    description,
    icons: [
      { src: "icon-192.png", sizes: "192x192", type: "image/png", purpose: "any" },
      { src: "icon-512.png", sizes: "512x512", type: "image/png", purpose: "any" },
      { src: "icon-512-maskable.png", sizes: "512x512", type: "image/png", purpose: "maskable" }
    ],
    shortcuts: S.shortcuts,
    categories: ($('categories').value || '').split(',').map(s => s.trim()).filter(Boolean),
    screenshots: ($('screenshots').value || '').split(',').map(u => ({ src: u.trim(), sizes: "1024x500", type: "image/png" })).filter(s => /^https?:\/\//.test(s.src))
  };

  const sw = `/* Cache-first with versioning */
const VERSION = '${Date.now()}';
const CORE = ['./','./index.html','./manifest.json','./icon-192.png','./icon-512.png'];
self.addEventListener('install',e=>{
  e.waitUntil(caches.open('pwa-'+VERSION).then(c=>c.addAll(CORE)));
});
self.addEventListener('activate',e=>{
  e.waitUntil(caches.keys().then(keys=>Promise.all(keys.filter(k=>k!=='pwa-'+VERSION).map(k=>caches.delete(k)))));
});
self.addEventListener('fetch',e=>{
  const req=e.request;
  e.respondWith(caches.match(req).then(r=>r||fetch(req).then(resp=>{
    if(req.method==='GET' && resp.ok){const copy=resp.clone(); caches.open('pwa-'+VERSION).then(c=>c.put(req,copy));}
    return resp;
  }).catch(()=>r)));
});`;

  const html = `<!doctype html><html lang="fa"><head>
<meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="manifest" href="./manifest.json"><meta name="theme-color" content="${themeColor}">
<title>${appName}</title><style>body{font-family:system-ui;margin:20px}</style></head>
<body><h1>${appName}</h1><p>${description || 'PWA آماده نصب'}</p>
<script>if('serviceWorker' in navigator){navigator.serviceWorker.register('./sw.js').catch(console.error)}</script>
</body></html>`;

  const zip = new JSZip();
  zip.file('manifest.json', JSON.stringify(manifest, null, 2));
  zip.file('sw.js', sw);
  zip.file('index.html', html);
  zip.file('icon-192.png', icon192);
  zip.file('icon-512.png', icon512);
  // generate maskable from 512
  const baseCanvas = await blobToCanvas(icon512);
  const ctx = baseCanvas.getContext('2d'); ctx.fillStyle='transparent'; // overlay safe ring
  ctx.strokeStyle = 'rgba(255,255,255,0.25)'; ctx.lineWidth = 32; ctx.beginPath(); ctx.arc(256,256,224,0,Math.PI*2); ctx.stroke();
  const maskBlob = await new Promise(res => baseCanvas.toBlob(res,'image/png'));
  zip.file('icon-512-maskable.png', maskBlob);
  if (splash) zip.file('splash.png', splash);

  const readme = `# PWA بسته‌بندی‌شده
- فایل‌ها را روی هاست HTTPS قرار دهید.
- manifest.json را مطابق دامنه و مسیر خود تنظیم کنید (start_url, scope).
- Service worker کش نسخه‌دار دارد؛ با هر انتشار جدید، نسخه تغییر می‌کند.
- اگر قصد انتشار APK دارید، از ورک‌فلو GitHub Actions استفاده کنید.`;
  zip.file('README.txt', readme);

  const blob = await zip.generateAsync({ type: 'blob' });
  saveAs(blob, `${appName.replace(/\s+/g,'_')}_PWA.zip`);
  log('✅ ZIP دانلود شد. آن را روی هاست HTTPS قرار بده.');
});

/* APK guide */
$('prepAPK').addEventListener('click', () => {
  const appName = $('appName').value.trim();
  const packageId = $('packageId').value.trim();
  const siteUrl = $('siteUrl').value.trim();
  const themeColor = $('themeColor').value;
  const bgColor = $('bgColor').value;
  const msg = `ورودی‌های اکشن:
- appName: ${appName}
- packageId: ${packageId}
- siteUrl: ${siteUrl}
- themeColor: ${themeColor}
- backgroundColor: ${bgColor}
- manifestUrl: اگر manifest.json روی هاستت پابلیک شد، URL آن را بده. در غیر این صورت اکشن خودش مانفیست می‌سازد.
- icon192Url/icon512Url/splashUrl (اختیاری): اگر آیکن‌ها را آپلود کردی.

مراحل:
1) در ریپو به تب Actions برو و «Build website into APK» را اجرا کن.
2) ورودی‌ها را وارد کن. منتظر بیلد بمان.
3) APK را از Artifacts دانلود کن. برای انتشار پایدار، تگ بزن تا Release ساخته شود.`;
  log(msg);
});

/* Reset */
$('resetForm').addEventListener('click', () => {
  localStorage.removeItem('appForm');
  location.reload();
});

/* Local storage autosave/load */
function saveForm(){
  const data = {
    appName:$('appName').value, packageId:$('packageId').value,
    siteUrl:$('siteUrl').value, scope:$('scope').value,
    themeColor:$('themeColor').value, bgColor:$('bgColor').value,
    display:$('display').value, description:$('description').value,
    categories:$('categories').value, screenshots:$('screenshots').value,
    shortcuts:S.shortcuts
  };
  localStorage.setItem('appForm', JSON.stringify(data));
}
function loadForm(){
  const raw = localStorage.getItem('appForm'); if(!raw) return;
  const d = JSON.parse(raw);
  $('appName').value=d.appName||''; $('packageId').value=d.packageId||'';
  $('siteUrl').value=d.siteUrl||''; $('scope').value=d.scope||'/';
  $('themeColor').value=d.themeColor||'#1f6feb'; $('bgColor').value=d.bgColor||'#ffffff';
  $('display').value=d.display||'standalone'; $('description').value=d.description||'';
  $('categories').value=d.categories||''; $('screenshots').value=d.screenshots||'';
  S.shortcuts = d.shortcuts||[];
  $('shortcutList').innerHTML = '';
  S.shortcuts.forEach(s=>{
    const li=document.createElement('li'); li.textContent=`${s.name} → ${s.url}`;
    const btn=document.createElement('button'); btn.textContent='حذف'; btn.className='btn-ghost ml-2';
    btn.onclick=()=>{S.shortcuts=S.shortcuts.filter(x=>x.url!==s.url); li.remove();};
    li.appendChild(btn); $('shortcutList').appendChild(li);
  });
  refreshPreview(); runChecks();
}
['appName','packageId','siteUrl','scope','themeColor','bgColor','display','description','categories','screenshots'].forEach(id => $(id).addEventListener('input', saveForm));
window.addEventListener('load', ()=>{ loadForm(); saveForm(); });

/* QR */
$('makeQR').addEventListener('click', () => {
  const url = $('qrUrl').value.trim(); if(!url){ log('URL خالی است.'); return; }
  QRCode.toCanvas($('qrCanvas'), url, { width: 160 }, err => {
    if (err) { log('خطا در ساخت QR'); return; }
    $('qrText').textContent = url;
    log('✅ QR ساخته شد.');
  });
});
</script>
</body>
</html>
