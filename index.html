<!doctype html>
<html lang="fa">
<head>
  <meta charset="utf-8">
  <title>Ø§Ø¨Ø²Ø§Ø± ØªØ¨Ø¯ÛŒÙ„ Ø³Ø§ÛŒØª Ø¨Ù‡ Ø§Ù¾Ù„ÛŒÚ©ÛŒØ´Ù† (PWA + APK)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body{font-family:system-ui,Segoe UI,Roboto,Arial;background:#f7f7f9;margin:0;padding:0}
    .wrap{max-width:960px;margin:40px auto;padding:0 20px}
    .card{background:#fff;border:1px solid #e6e6e9;border-radius:14px;padding:18px;margin-bottom:16px;box-shadow:0 2px 6px rgba(0,0,0,.06)}
    h1{font-size:24px;margin-bottom:14px}
    label{display:block;margin:10px 0 6px;font-weight:600}
    input[type="text"],input[type="url"],input[type="color"]{width:100%;padding:10px;border:1px solid #ddd;border-radius:10px}
    input[type="file"]{width:100%}
    .row{display:grid;grid-template-columns:1fr 1fr;gap:14px}
    .btn{display:inline-block;background:#1f6feb;color:#fff;border:none;border-radius:10px;padding:12px 16px;cursor:pointer}
    .btn.secondary{background:#6a737d}
    .btn.success{background:#0b8b36}
    .hint{color:#666;font-size:13px}
    .out{white-space:pre-wrap;background:#0b1020;color:#e6edf3;padding:12px;border-radius:12px;overflow:auto}
    .ok{color:#0b8b36;font-weight:700}
    .warn{color:#a15a00;font-weight:700}
    .qr{display:flex;align-items:center;gap:14px;margin-top:10px}
    canvas.qr{border:1px solid #ddd;border-radius:10px;background:#fff}
    .footer{color:#666;font-size:12px;text-align:center;margin-top:12px}
  </style>
  <script src="https://cdn.jsdelivr.net/npm/jszip@3.10.1/dist/jszip.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/file-saver@2.0.5/dist/FileSaver.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js"></script>
</head>
<body>
  <div class="wrap">
    <div class="card">
      <h1>ğŸš€ ØªØ¨Ø¯ÛŒÙ„ Ø³Ø§ÛŒØª Ø¨Ù‡ Ø§Ù¾Ù„ÛŒÚ©ÛŒØ´Ù† (PWA ÙÙˆØ±ÛŒ + APK Ø¨Ø§ GitHub Actions)</h1>
      <p class="hint">ÙØ±Ù… Ø±Ø§ Ù¾Ø± Ú©Ù†ØŒ Â«Ø³Ø§Ø®Øª ÙˆØ¨â€ŒØ§Ù¾Ù„ÛŒÚ©ÛŒØ´Ù†Â» Ø±Ø§ Ø¨Ø²Ù†â€”ÙØ§ÛŒÙ„ ZIP Ø¢Ù…Ø§Ø¯Ù‡ Ù†ØµØ¨ (PWA) Ù‡Ù…ÛŒÙ†â€ŒØ¬Ø§ Ø¯Ø§Ù†Ù„ÙˆØ¯ Ù…ÛŒâ€ŒØ´ÙˆØ¯. Ø¨Ø±Ø§ÛŒ APKØŒ Ù‡Ù…Ø§Ù† ÙˆØ±ÙˆØ¯ÛŒâ€ŒÙ‡Ø§ Ø¯Ø± Ø§Ú©Ø´Ù† Ø¨ÛŒÙ„Ø¯ Ø§Ø³ØªÙØ§Ø¯Ù‡ Ù…ÛŒâ€ŒØ´ÙˆÙ†Ø¯.</p>
    </div>

    <div class="card">
      <form id="appForm">
        <label>Ù†Ø§Ù… Ø§Ù¾</label>
        <input type="text" id="appName" required placeholder="Ù…Ø«Ù„Ø§Ù‹: ØªØ¹Ù…ÛŒØ± ØªØ®ØµØµÛŒ Ù…Ø¨Ù„Ù…Ø§Ù†">

        <label>Ø´Ù†Ø§Ø³Ù‡ Ù¾Ú©ÛŒØ¬ Ø§Ù†Ø¯Ø±ÙˆÛŒØ¯</label>
        <input type="text" id="packageId" required placeholder="Ù…Ø«Ù„Ø§Ù‹: com.nima.furniture">

        <label>Ø¢Ø¯Ø±Ø³ Ø³Ø§ÛŒØª (start_url)</label>
        <input type="url" id="siteUrl" required placeholder="https://example.com">

        <div class="row">
          <div>
            <label>Ø±Ù†Ú¯ ØªÙ…</label>
            <input type="color" id="themeColor" value="#e53935">
          </div>
          <div>
            <label>Ø±Ù†Ú¯ Ù¾Ø³â€ŒØ²Ù…ÛŒÙ†Ù‡</label>
            <input type="color" id="bgColor" value="#ffffff">
          </div>
        </div>

        <div class="row">
          <div>
            <label>Ø¢ÛŒÚ©Ù† 192px (PNG)</label>
            <input type="file" id="icon192" accept="image/png">
          </div>
          <div>
            <label>Ø¢ÛŒÚ©Ù† 512px (PNG)</label>
            <input type="file" id="icon512" accept="image/png">
          </div>
        </div>

        <label>Ø§Ø³Ù¾Ù„Ø´ Ø§Ø³Ú©Ø±ÛŒÙ† (Ø§Ø®ØªÛŒØ§Ø±ÛŒØŒ PNG)</label>
        <input type="file" id="splash" accept="image/png">

        <div class="row" style="margin-top:14px">
          <button type="button" class="btn" id="buildPWA">Ø³Ø§Ø®Øª ÙˆØ¨â€ŒØ§Ù¾Ù„ÛŒÚ©ÛŒØ´Ù† Ùˆ Ø¯Ø§Ù†Ù„ÙˆØ¯ ZIP</button>
          <button type="button" class="btn secondary" id="prepAPK">Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒ Ø¨ÛŒÙ„Ø¯ APK (GitHub Actions)</button>
        </div>
      </form>
    </div>

    <div class="card">
      <h2>ğŸ”— QR Ú©Ø¯ Ø¨Ø±Ø§ÛŒ Ù†ØµØ¨/Ù†Ù…Ø§ÛŒØ´</h2>
      <p class="hint">Ø¨Ø¹Ø¯ Ø§Ø² Ø¢Ù¾Ù„ÙˆØ¯ ZIP Ø±ÙˆÛŒ Ù‡Ø§Ø³Øª HTTPS Ø®ÙˆØ¯ØªØŒ Ù„ÛŒÙ†Ú© ØµÙØ­Ù‡ PWA Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù† ØªØ§ QR Ø³Ø§Ø®ØªÙ‡ Ø´ÙˆØ¯.</p>
      <div class="row">
        <input type="url" id="pwaUrl" placeholder="https://yourdomain.com/pwa/index.html">
        <button class="btn success" id="makeQR">Ø³Ø§Ø®Øª QR</button>
      </div>
      <div class="qr">
        <canvas id="qrCanvas" class="qr" width="180" height="180"></canvas>
        <div>
          <div class="hint">Ø§ÛŒÙ† QR Ø±Ø§ Ø¨Ø±Ø§ÛŒ Ù†ØµØ¨ Ø³Ø±ÛŒØ¹ Ø¨Ù‡ Ù…Ø´ØªØ±ÛŒ Ø¨Ø¯Ù‡.</div>
          <div id="qrLink" class="hint"></div>
        </div>
      </div>
    </div>

    <div class="card">
      <div class="out" id="log"></div>
      <p class="footer">PWA ÙÙˆØ±Ø§Ù‹ Ùˆ Ø¨Ø¯ÙˆÙ† Ø³Ø±ÙˆØ± Ø³Ø§Ø®ØªÙ‡ Ù…ÛŒâ€ŒØ´ÙˆØ¯. APK Ø¨Ø§ Bubblewrap Ø¯Ø± GitHub Actions Ø³Ø§Ø®ØªÙ‡ Ùˆ Ø¨Ù‡â€ŒØµÙˆØ±Øª Artifact/Release Ù‚Ø§Ø¨Ù„ Ø¯Ø§Ù†Ù„ÙˆØ¯ Ø§Ø³Øª.</p>
    </div>
  </div>

<script>
const log = (msg, cls) => {
  const el = document.getElementById('log');
  const line = document.createElement('div');
  line.textContent = msg;
  if (cls) line.className = cls;
  el.appendChild(line);
};

async function fileToPng(file, size) {
  if (!file) return generateDefaultIcon(size);
  const bitmap = await createImageBitmap(await file.arrayBuffer());
  const canvas = document.createElement('canvas');
  canvas.width = size; canvas.height = size;
  const ctx = canvas.getContext('2d');
  const scale = Math.min(size/bitmap.width, size/bitmap.height);
  const w = bitmap.width * scale, h = bitmap.height * scale;
  ctx.clearRect(0,0,size,size);
  ctx.drawImage(bitmap, (size-w)/2, (size-h)/2, w, h);
  return await new Promise(res => canvas.toBlob(res, 'image/png'));
}

async function generateDefaultIcon(size) {
  const canvas = document.createElement('canvas');
  canvas.width = size; canvas.height = size;
  const ctx = canvas.getContext('2d');
  ctx.fillStyle = document.getElementById('themeColor').value;
  ctx.fillRect(0,0,size,size);
  ctx.fillStyle = '#fff';
  ctx.font = `${Math.round(size*0.5)}px system-ui`;
  ctx.textAlign = 'center';
  ctx.textBaseline = 'middle';
  ctx.fillText('A', size/2, size/2);
  return await new Promise(res => canvas.toBlob(res, 'image/png'));
}

document.getElementById('buildPWA').addEventListener('click', async () => {
  document.getElementById('log').textContent = '';
  const appName = document.getElementById('appName').value.trim();
  const siteUrl = document.getElementById('siteUrl').value.trim();
  const themeColor = document.getElementById('themeColor').value;
  const bgColor = document.getElementById('bgColor').value;
  if (!appName || !siteUrl) { log('Ù„Ø·ÙØ§Ù‹ Ù†Ø§Ù… Ø§Ù¾ Ùˆ Ø¢Ø¯Ø±Ø³ Ø³Ø§ÛŒØª Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†.', 'warn'); return; }

  log('Ø³Ø§Ø®Øª ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ PWA Ø´Ø±ÙˆØ¹ Ø´Ø¯...');
  const icon192File = document.getElementById('icon192').files[0];
  const icon512File = document.getElementById('icon512').files[0];
  const splashFile = document.getElementById('splash').files[0];

  const icon192 = await fileToPng(icon192File, 192);
  const icon512 = await fileToPng(icon512File, 512);
  const splash = splashFile ? splashFile : null;

  const manifest = {
    name: appName,
    short_name: appName,
    start_url: siteUrl,
    scope: "/",
    display: "standalone",
    background_color: bgColor,
    theme_color: themeColor,
    icons: [
      { src: "icon-192.png", sizes: "192x192", type: "image/png" },
      { src: "icon-512.png", sizes: "512x512", type: "image/png" }
    ]
  };

  const sw = `self.addEventListener('install',e=>{
  e.waitUntil(caches.open('pwa-cache').then(c=>c.addAll(['./','./index.html','./manifest.json'])))
});
self.addEventListener('fetch',e=>{
  e.respondWith(caches.match(e.request).then(r=>r||fetch(e.request)))
});`;

  const html = `<!doctype html><html lang="fa"><head>
<meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="manifest" href="./manifest.json">
<meta name="theme-color" content="${themeColor}">
<title>${appName}</title>
<style>body{font-family:system-ui;margin:20px}</style></head>
<body><h1>${appName}</h1><p>PWA Ø¢Ù…Ø§Ø¯Ù‡ Ù†ØµØ¨</p>
<script>if('serviceWorker' in navigator){navigator.serviceWorker.register('./sw.js').catch(console.error)}</script>
</body></html>`;

  const zip = new JSZip();
  zip.file('manifest.json', JSON.stringify(manifest, null, 2));
  zip.file('sw.js', sw);
  zip.file('index.html', html);
  zip.file('icon-192.png', icon192);
  zip.file('icon-512.png', icon512);
  if (splash) zip.file('splash.png', splash);

  const blob = await zip.generateAsync({type:'blob'});
  saveAs(blob, `${appName.replace(/\s+/g,'_')}_PWA.zip`);
  log('âœ… ÙˆØ¨â€ŒØ§Ù¾Ù„ÛŒÚ©ÛŒØ´Ù† Ø³Ø§Ø®ØªÙ‡ Ø´Ø¯ Ùˆ ZIP Ø¯Ø§Ù†Ù„ÙˆØ¯ Ø´Ø¯.', 'ok');
  log('Ø±Ø§Ù‡Ù†Ù…Ø§: ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ Ø±Ø§ Ø±ÙˆÛŒ Ù‡Ø§Ø³Øª HTTPS Ù‚Ø±Ø§Ø± Ø¨Ø¯Ù‡Ø› Ù„ÛŒÙ†Ú© Ù†ØµØ¨ (Add to Home Screen) ÙØ¹Ø§Ù„ Ù…ÛŒâ€ŒØ´ÙˆØ¯.');
});

document.getElementById('prepAPK').addEventListener('click', () => {
  const appName = document.getElementById('appName').value.trim();
  const packageId = document.getElementById('packageId').value.trim();
  const siteUrl = document.getElementById('siteUrl').value.trim();
  const themeColor = document.getElementById('themeColor').value;
  const bgColor = document.getElementById('bgColor').value;
  if (!appName || !packageId || !siteUrl) { log('Ù„Ø·ÙØ§Ù‹ Ù†Ø§Ù… Ø§Ù¾ØŒ Ù¾Ú©ÛŒØ¬ Ø¢ÛŒâ€ŒØ¯ÛŒ Ùˆ Ø¢Ø¯Ø±Ø³ Ø³Ø§ÛŒØª Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†.', 'warn'); return; }

  const guide = `ÙˆØ±ÙˆØ¯ÛŒâ€ŒÙ‡Ø§ Ø¨Ø±Ø§ÛŒ GitHub Actions:
- appName: ${appName}
- packageId: ${packageId}
- siteUrl: ${siteUrl}
- themeColor: ${themeColor}
- backgroundColor: ${bgColor}
- manifestUrl: Ø§Ú¯Ø± ZIP Ø±Ø§ Ø±ÙˆÛŒ Ù‡Ø§Ø³Øª Ú¯Ø°Ø§Ø´ØªÛŒ Ùˆ manifest.json Ù‚Ø§Ø¨Ù„ Ø¯Ø³ØªØ±Ø³ Ø§Ø³ØªØŒ URL Ø¢Ù† Ø±Ø§ Ø¨Ø¯Ù‡Ø› Ø§Ú¯Ø± Ù†Ù‡ØŒ Ø§Ú©Ø´Ù† Ø®ÙˆØ¯Ø´ Ù…ÛŒâ€ŒØ³Ø§Ø²Ø¯.
- icon192Url / icon512Url / splashUrl: Ø§Ú¯Ø± ÙØ§ÛŒÙ„â€ŒÙ‡Ø§ Ø±Ø§ Ø±ÙˆÛŒ Ù‡Ø§Ø³ØªØª Ø¢Ù¾Ù„ÙˆØ¯ Ú©Ø±Ø¯ÛŒØŒ URL Ø¢Ù†â€ŒÙ‡Ø§ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†.

Ú¯Ø§Ù…â€ŒÙ‡Ø§:
1) Ø¨Ù‡ Ø±ÛŒÙ¾Ø§Ø²ÛŒØªÙˆØ±ÛŒ Ø¨Ø±Ùˆ â†’ Actions â†’ Â«Build website into APKÂ» â†’ Run workflow.
2) Ù‡Ù…ÛŒÙ† ÙˆØ±ÙˆØ¯ÛŒâ€ŒÙ‡Ø§ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†.
3) Ù¾Ø³ Ø§Ø² Ø¨ÛŒÙ„Ø¯ØŒ APK Ø§Ø² Artifact Ø¯Ø§Ù†Ù„ÙˆØ¯ Ù…ÛŒâ€ŒØ´ÙˆØ¯. Ø¨Ø±Ø§ÛŒ Ø§Ù†ØªØ´Ø§Ø± Ø­Ø±ÙÙ‡â€ŒØ§ÛŒØŒ ØªÚ¯ Ø¨Ø²Ù† ØªØ§ Release Ø¨Ø³Ø§Ø²Ø¯.`;
  document.getElementById('log').textContent = '';
  log('ğŸ”§ Ø¨ÛŒÙ„Ø¯ APK Ø§Ø² Ø·Ø±ÛŒÙ‚ GitHub Actions Ø§Ù†Ø¬Ø§Ù… Ù…ÛŒâ€ŒØ´ÙˆØ¯. Ø±Ø§Ù‡Ù†Ù…Ø§ÛŒ Ø³Ø±ÛŒØ¹ Ø²ÛŒØ± Ø±Ø§ Ø¨Ø¨ÛŒÙ†:', 'warn');
  log(guide);
});

document.getElementById('makeQR').addEventListener('click', () => {
  const url = document.getElementById('pwaUrl').value.trim();
  const canvas = document.getElementById('qrCanvas');
  const linkEl = document.getElementById('qrLink');
  if (!url) { log('Ù„ÛŒÙ†Ú© PWA Ø±ÙˆÛŒ Ù‡Ø§Ø³ØªØª Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†.', 'warn'); return; }
  QRCode.toCanvas(canvas, url, { width: 180 }, err => {
    if (err) { log('Ø®Ø·Ø§ Ø¯Ø± Ø³Ø§Ø®Øª QR', 'warn'); return; }
    linkEl.textContent = url;
    log('âœ… QR Ø³Ø§Ø®ØªÙ‡ Ø´Ø¯. Ø¢Ù† Ø±Ø§ Ø¨Ø±Ø§ÛŒ Ù†ØµØ¨ Ø³Ø±ÛŒØ¹ Ø¨Ù‡ Ù…Ø´ØªØ±ÛŒ Ø¨Ø¯Ù‡.', 'ok');
  });
});
</script>
</body>
</html>
